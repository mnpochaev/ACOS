# Отчет по заданию «RISC-V. Арифметический сопроцессор»

**Студент:** Почаев М. Н.  
**Группа:** БПИ-244  
**Вариант:** 17  

Решение на 8.
## Условие задачи
Разработать программу на ассемблере RISC-V (RARS) с использованием команд арифметического сопроцессора, вычисляющую с помощью степенного ряда значение функции `ln(1 - x)` для входного параметра `x`, с точностью не хуже 0,1%. Учесть область определения (|x| < 1), использовать числа двойной точности (double). Программа должна запускаться в RARS, ввод с клавиатуры, вывод на дисплей. Добавить автоматизированные тесты.

## Структура и используемые модули
- `macrolib.asm` — макросы сохранения регистров и макросы ввода/вывода под double.
- `iolib.asm` — унифицированные подпрограммы ввода/вывода (int/double), константы `float_0/1/m1`, проверка диапазона `check_float_range`, модуль числа `fabs`.
- `mathlib.asm` — функция `calculate_ln_series` (double), вычисляет `ln(1-x)` по ряду с ограничением по epsilon и 1000 итераций.
- `test.asm` — автотесты на трех значениях, сравнение с ожидаемыми с порогом epsilon.
- `main.asm` — меню (ручной режим, запуск тестов, выход), проверка диапазона, вызов вычисления и вывод результата/итераций.


## Описание метода
Используется степенной ряд:
```
ln(1 - x) = -Σ (x^n / n), n = 1..∞
```
Алгоритм:
1) Начальные значения: `sum = 0`, `x_power = x`, `n = 1`.
2) Текущий член `term = x_power / n`, `sum = sum - term`.
3) Проверка остановки: `|term| < epsilon` или достигнут предел 1000 итераций.
4) Обновление: `x_power *= x`, `n++`, `iterations++`.
Все операции — double (`fld/fsd/fdiv.d/fmul.d/fsub.d/fle.d/fmv.d`). Диапазон входа контролируется `check_float_range` (включительно по границам, поэтому условие |x|<1 обеспечивается корректным вводом).

Точность: epsilon = 0.001 обеспечивает 0.1% при разумных x (|x|<1).

## Передача параметров и соглашения
- Вызовы подпрограмм используют регистры аргументов: `fa0/fa1` (x, epsilon), возврат `fa0` (значение), `a1` (итерации).
- Локальные переменные и сохранение вызываемых регистров выполняются на стеке в `calculate_ln_series` по соглашениям RISC-V.
- Макросы ввода/вывода используют системные вызовы RARS: 7 (read_double), 3 (print_double), 5 (read_int), 1 (print_int), 4 (print_string), 10 (exit).

## Тестирование
Автотесты (`test.asm`):
- x = 0.1, ожидаемое `ln(0.9) ≈ -0.105360`
- x = 0.5, ожидаемое `ln(0.5) ≈ -0.693147`
- x = -0.3, ожидаемое `ln(1.3) ≈ 0.262364`
Критерий прохождения: `|calc - expected| < epsilon`.

Также реализован тест на C++ `test.cpp`.
